function utf8_encode(a){if(null===a||"undefined"==typeof a)return"";var b,c,d=a+"",e="",f=0;b=c=0,f=d.length;for(var g=0;f>g;g++){var h=d.charCodeAt(g),i=null;if(128>h)c++;else if(h>127&&2048>h)i=String.fromCharCode(h>>6|192,63&h|128);else if(55296!=(63488&h))i=String.fromCharCode(h>>12|224,h>>6&63|128,63&h|128);else{if(55296!=(64512&h))throw new RangeError("Unmatched trail surrogate at "+g);var j=d.charCodeAt(++g);if(56320!=(64512&j))throw new RangeError("Unmatched lead surrogate at "+(g-1));h=((1023&h)<<10)+(1023&j)+65536,i=String.fromCharCode(h>>18|240,h>>12&63|128,h>>6&63|128,63&h|128)}null!==i&&(c>b&&(e+=d.slice(b,c)),e+=i,b=c=g+1)}return c>b&&(e+=d.slice(b,f)),e}function addCommas(a){var b,c,d,e;for(a+="",c=a.split("."),d=c[0],e=c.length>1?FAOSTATNEWOLAP.decimalSeparator+c[1]:"",b=/(\d+)(\d{3})/;b.test(d);)d=d.replace(b,"$1"+FAOSTATNEWOLAP.thousandSeparator+"$2");return" "===FAOSTATNEWOLAP.thousandSeparator&&(d=d.replace(/\s/g,"")),d+e}function ExtractCode(a,b){for(ret=[],i=0;i<a.length;i++)ret.push(">"===a[i].type?b+a[i].code+">"+b:b+a[i].code+b);return ret}function ExtractCodel(a){for(ret=[],i=0;i<a.length;i++)">"===a[i].type&&ret.push({code:a[i].code,type:"list"});return ret}function checkMemory(){for(var b in window)window.hasOwnProperty(b)&&console.log(b+" "+memorySizeOf(eval(b)))}function memorySizeOf(a){function b(a){if(null!==a&&void 0!==a)switch(typeof a){case"number":d+=8;break;case"string":d+=2*a.length;break;case"boolean":d+=4;break;case"object":var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c||"Array"===c)for(var e in a)a.hasOwnProperty(e)&&b(a[e]);else d+=2*a.toString().length}return d}function c(a){return 1024>a?a+" bytes":1048576>a?(a/1024).toFixed(3)+" KiB":1073741824>a?(a/1048576).toFixed(3)+" MiB":(a/1073741824).toFixed(3)+" GiB"}var d=0;return c(b(a))}function oldSchoolCSV(a){var b="EXECUTE Warehouse.dbo.usp_GetDataTESTP  @DomainCode = '"+F3DWLD.CONFIG.domainCode+"',   @lang = '"+F3DWLD.CONFIG.lang+"',   @List1Codes = '("+ExtractCode(F3DWLD.CONFIG.selectedValues[0],"''")+")',   @List2Codes = '("+ExtractCode(F3DWLD.CONFIG.selectedValues[1],"''")+")',   @List3Codes = '("+ExtractCode(F3DWLD.CONFIG.selectedValues[2],"''")+")',   @List4Codes = '("+ExtractCode(F3DWLD.CONFIG.selectedValues[3],"")+")',    @List5Codes = '',     @List6Codes = '',     @List7Codes = '',     @NullValues = 0,     @Thousand = '',     @Decimal = '.',     @DecPlaces = 2 ,   @Limit ="+FAOSTATNEWOLAP.pivotlimitExcel,c={};for(var d in FAOSTATOLAP2.options)c[d]=FAOSTATOLAP2.options[d];c.lang=F3DWLD.CONFIG.lang,("HS"==F3DWLD.CONFIG.domainCode||"TM"==F3DWLD.CONFIG.domainCode||"FT"==F3DWLD.CONFIG.domainCode)&&(c.rows=["Reporter Countries","Partner Countries","Item","Element"],c.cols=["Year"],b="EXECUTE Warehouse.dbo.usp_GetData  @DomainCode = '"+F3DWLD.CONFIG.domainCode+"',   @lang = '"+F3DWLD.CONFIG.lang+"',   @List1Codes = '("+ExtractCode(F3DWLD.CONFIG.selectedValues[0],"''")+")',   @List2Codes = '("+ExtractCode(F3DWLD.CONFIG.selectedValues[1],"''")+")',   @List3Codes = '("+ExtractCode(F3DWLD.CONFIG.selectedValues[2],"''")+")',   @List4Codes = '("+ExtractCode(F3DWLD.CONFIG.selectedValues[3],"''")+")',    @List5Codes = '("+ExtractCode(F3DWLD.CONFIG.selectedValues[4],"")+")',     @List6Codes = '',     @List7Codes = '',     @NullValues = 0,     @Thousand = '',     @Decimal = '.',     @DecPlaces = 2 ,   @Limit ="+FAOSTATNEWOLAP.pivotlimitExcel),0==FAOSTATNEWOLAP.firstCall?(c.rows=FAOSTATNEWOLAP.internalData.rowAttrs,c.cols=FAOSTATNEWOLAP.internalData.colAttrs):(c.rows=null,c.cols=null),c.vals=["Value"],c.domain=F3DWLD.CONFIG.domainCode,F3DWLD.CONFIG.wdsPayload.showUnits&&c.vals.push("Unit"),F3DWLD.CONFIG.wdsPayload.showFlags&&c.vals.push("Flag"),document.getElementById("CSVOLAPsql").value=b,document.getElementById("CSVOLAPjson").value=JSON.stringify(c),document.getElementById("CSVOLAPoption").value=JSON.stringify({decimal:FAOSTATNEWOLAP.decimal,decimalSeparator:FAOSTATNEWOLAP.decimalSeparator,thousandSeparator:FAOSTATNEWOLAP.thousandSeparator,showUnits:F3DWLD.CONFIG.wdsPayload.showUnits,showFlags:F3DWLD.CONFIG.wdsPayload.showFlags,showCodes:F3DWLD.CONFIG.wdsPayload.showCodes,fileFormat:a}),document.getElementById("exportCSVOLAP").submit()}function oldSchool(a,b){var c="EXECUTE Warehouse.dbo.usp_GetDataTESTP  @DomainCode = '"+F3DWLD.CONFIG.domainCode+"',   @lang = '"+F3DWLD.CONFIG.lang+"',   @List1Codes = '("+ExtractCode(F3DWLD.CONFIG.selectedValues[0],"''")+")',   @List2Codes = '("+ExtractCode(F3DWLD.CONFIG.selectedValues[1],"''")+")',   @List3Codes = '("+ExtractCode(F3DWLD.CONFIG.selectedValues[2],"''")+")',   @List4Codes = '("+ExtractCode(F3DWLD.CONFIG.selectedValues[3],"")+")',    @List5Codes = '',     @List6Codes = '',     @List7Codes = '',     @NullValues = 0,     @Thousand = '',     @Decimal = '.',     @DecPlaces = 2 ,   @Limit ="+a;("HS"==F3DWLD.CONFIG.domainCode||"TM"==F3DWLD.CONFIG.domainCode||"FT"==F3DWLD.CONFIG.domainCode)&&(c="EXECUTE Warehouse.dbo.usp_GetData  @DomainCode = '"+F3DWLD.CONFIG.domainCode+"',   @lang = '"+F3DWLD.CONFIG.lang+"',   @List1Codes = '("+ExtractCode(F3DWLD.CONFIG.selectedValues[0],"''")+")',   @List2Codes = '("+ExtractCode(F3DWLD.CONFIG.selectedValues[1],"''")+")',   @List3Codes = '("+ExtractCode(F3DWLD.CONFIG.selectedValues[2],"''")+")',   @List4Codes = '("+ExtractCode(F3DWLD.CONFIG.selectedValues[3],"''")+")',    @List5Codes = '("+ExtractCode(F3DWLD.CONFIG.selectedValues[4],"")+")',     @List6Codes = '',     @List7Codes = '',     @NullValues = 0,     @Thousand = '',     @Decimal = '.',     @DecPlaces = 2 ,   @Limit ="+FAOSTATNEWOLAP.pivotlimitExcel);var d={datasource:F3DWLD.CONFIG.datasource,thousandSeparator:",",decimalSeparator:".",decimalNumbers:"2",json:JSON.stringify({limit:null,query:c,frequency:"NONE"}),cssFilename:"",valueIndex:5};$("#fx-olap-ui").html('<center><img src="/faostat-download-js/pivotAgg/Preload.gif" /></center>'),FAOSTATNEWOLAP.flags={},$.ajax({type:"POST",url:F3DWLD.CONFIG.data_url+"/table/json",data:d,success:function(a){var c=[],d={},e=retConfig(F3DWLD.CONFIG.domainCode,F3DWLD.CONFIG.lang);c=e[0],d=e[1],a=c.concat(a),FAOSTATNEWOLAP.firstCall=0;$.pivotUtilities.derivers,$.extend($.pivotUtilities.renderers,$.pivotUtilities.gchart_renderers);d.vals=["Value"],F3DWLD.CONFIG.wdsPayload.showUnits&&d.vals.push("Unit"),F3DWLD.CONFIG.wdsPayload.showFlags&&d.vals.push("Flag"),FAOSTATNEWOLAP.originalData=a,$("#fx-olap-ui").pivotUI(a,d,!0),$("#options_menu_box").css("display","block");var f="";for(var g in FAOSTATNEWOLAP.flags)""!=f&&(f+=":"),f+="'"+g+"'";""==f&&(f="''"),$.get("http://faostat3.fao.org/faostat.olap.ws/rest/GetFlags/"+F3DWLD.CONFIG.lang+"/"+f,function(a){a=a.replace("localhost:8080/","faostat3.fao.org/"),$("#mesFlags").append(a),b&&decolrowspanNEW()})}})}function newFunctions(){FAOSTATNEWOLAP.viewVals=1,$("#vals").css("display","block"),$("#unused").css("display","block"),$("#unused li").css("display","inline"),$(".pvtRenderer").css("display","block"),$("#aggregator").css("display","block"),$("#unused").css("background-color","#ececec"),$("#unused li nobr").css("color","#666")}function changeNested(){FAOSTATNEWOLAP.nestedby=document.getElementById("cbNestedBy").checked?1:0}function directExcel(a){var b={};b.query="SELECT D.ItemCode, D.ElementCode, AVG(D.value) FROM Data AS D WHERE D.DomainCode IN ('GT', 'GM', 'GE', 'GR', 'GY', 'GU', 'GP', 'GA', 'GV', 'GB') AND D.AreaCode = 10 AND D.ElementCode IN (7244, 7243, 72254, 72256, 72306, 72255, 7243, 72343, 72341, 72342, 72308, 72340, 7237, 72259, 72309, 72257, 72307) AND D.ItemCode IN (1711, 1755, 27, 1709, 3107, 1712, 6729, 5057, 6795) GROUP BY D.ItemCode, D.ElementCode";var c={};c.datasource=FAOSTATDownload.datasource,c.thousandSeparator=",",c.decimalSeparator=".",c.decimalNumbers=2,c.json=JSON.stringify({limit:null,query:a,frequency:"NONE"}),c.cssFilename="",c.nowrap=!1,c.valuesIndex=0,$("#datasource_WQ").val(FAOSTATDownload.datasource),$("#json_WQ").val(c.json),document.excelFormWithQuotes.submit()}function directCSV(a){var b={};b.query="SELECT D.ItemCode, D.ElementCode, AVG(D.value) FROM Data AS D WHERE D.DomainCode IN ('GT', 'GM', 'GE', 'GR', 'GY', 'GU', 'GP', 'GA', 'GV', 'GB') AND D.AreaCode = 10 AND D.ElementCode IN (7244, 7243, 72254, 72256, 72306, 72255, 7243, 72343, 72341, 72342, 72308, 72340, 7237, 72259, 72309, 72257, 72307) AND D.ItemCode IN (1711, 1755, 27, 1709, 3107, 1712, 6729, 5057, 6795) GROUP BY D.ItemCode, D.ElementCode";var c={};c.datasource=FAOSTATDownload.datasource,c.thousandSeparator=",",c.decimalSeparator=".",c.decimalNumbers=2,c.json=JSON.stringify({limit:null,query:a,frequency:"NONE"}),c.cssFilename="",c.nowrap=!1,c.valuesIndex=0,$("#datasource_WQ_csv").val(FAOSTATDownload.datasource),$("#json_WQ_csv").val(c.json),document.csvFormWithQuotes.submit()}function recTab1(a,b,c){if(ret="",b.length==c+1)for(var d=0;d<b[c].data.length;d++)ret+=",CONCAT('''',MIN(["+a+b[c].data[d].label+"])) as ["+a+b[c].data[d].label+"],CONCAT('''',MIN(["+a+b[c].data[d].label+"_u])) as ["+a+b[c].data[d].label+"_u],CONCAT('''',MIN(["+a+b[c].data[d].label+"_f])) as ["+a+b[c].data[d].label+"_f]";else for(var d=0;d<b[c].data.length;d++)ret+=recTab1(a+b[c].data[d].label+"_",b,c+1);return ret}function recHeader(a,b,c){if(ret="",b.length==c+1)for(var d=0;d<b[c].data.length;d++)ret+=',"'+a+b[c].data[d].label+'","'+a+b[c].data[d].label+'_u","'+a+b[c].data[d].label+'_f"';else for(var d=0;d<b[c].data.length;d++)ret+=recHeader(a+b[c].data[d].label+"_",b,c+1);return ret}function recTab2(a,b,c,d){if(ret="",c.length==d+1)for(var e=0;e<c[d].data.length;e++)ret+=",CASE when "+b+" ["+FAOSTATNEWOLAP.traduction[c[d].title]+" Code]=''"+c[d].data[e].code+"''  then MIN(Value) end as ["+a+c[d].data[e].label+"],",ret+="CASE when "+b+" ["+FAOSTATNEWOLAP.traduction[c[d].title]+" Code]=''"+c[d].data[e].code+"''   then MIN(Unit) end as ["+a+c[d].data[e].label+"_u],",ret+="CASE when "+b+" ["+FAOSTATNEWOLAP.traduction[c[d].title]+" Code]=''"+c[d].data[e].code+"''   then MIN(Flag) end as ["+a+c[d].data[e].label+"_f]";else for(var e=0;e<c[d].data.length;e++)my_cond="["+FAOSTATNEWOLAP.traduction[c[d].title]+" Code]=''"+c[d].data[e].code+"''",ret+=recTab2(a+c[d].data[e].label+"_",my_cond+" AND "+b,c,d+1);return ret}function retPivot1(){var a="'"+retPivot3();return a+=recTab1("",FAOSTATNEWOLAP.PP.PP1,0),a+="'"}function retPivot2(){var a="'"+retPivot3();return a+=recTab2("","",FAOSTATNEWOLAP.PP.PP1,0),a+="'"}function retPivot3(){for(ret="",i=0;i<FAOSTATNEWOLAP.PP.PP3.length;i++)ret+=i>0?","+FAOSTATNEWOLAP.traduction[FAOSTATNEWOLAP.PP.PP3[i]]:FAOSTATNEWOLAP.traduction[FAOSTATNEWOLAP.PP.PP3[0]];return ret}function ExcelComplete2(){for(FAOSTATNEWOLAP.PP={PP1:[],PP2:[],PP3:[]},i=0;i<document.getElementById("rows").getElementsByTagName("nobr").length;i++){var a=document.getElementById("rows").getElementsByTagName("nobr")[i];FAOSTATNEWOLAP.PP.PP3.push(a.innerHTML)}for(i=0;i<document.getElementById("cols").getElementsByTagName("nobr").length;i++){var a=document.getElementById("cols").getElementsByTagName("nobr")[i];for(jj=-1,title="",j=0;j<FAOSTATNEWOLAP.schema.length;j++)if(FAOSTATNEWOLAP.schema[j][6]==a.innerHTML){jj=parseInt(FAOSTATNEWOLAP.schema[j][4])-1,title=FAOSTATNEWOLAP.schema[j][1];break}jj>-1?FAOSTATNEWOLAP.PP.PP1.push({title:title,data:F3DWLD.CONFIG.selectedValues[jj]}):alert("not found"+a.innerHTML)}}function ExcelComplete(a){for(FAOSTATNEWOLAP.PP={PP1:[],PP2:[],PP3:[]},i=0;i<document.getElementById("rows").getElementsByTagName("nobr").length;i++){var b=document.getElementById("rows").getElementsByTagName("nobr")[i];for(j=0;j<FAOSTATNEWOLAP.schema.length;j++)FAOSTATNEWOLAP.schema[j][6]==b.innerHTML&&FAOSTATNEWOLAP.PP.PP3.push(FAOSTATNEWOLAP.schema[j][1])}for(i=0;i<document.getElementById("cols").getElementsByTagName("nobr").length;i++){var b=document.getElementById("cols").getElementsByTagName("nobr")[i];for(jj=-1,title="",j=0;j<FAOSTATNEWOLAP.schema.length;j++)if(FAOSTATNEWOLAP.schema[j][6]==b.innerHTML){jj=parseInt(FAOSTATNEWOLAP.schema[j][4])-1,title=FAOSTATNEWOLAP.schema[j][1];break}jj>-1?FAOSTATNEWOLAP.PP.PP1.push({title:title,data:F3DWLD.CONFIG.selectedValues[jj]}):alert("not found"+b.innerHTML)}var c={datasource:F3DWLD.CONFIG.datasource,thousandSeparator:" ",decimalSeparator:".",decimalNumbers:"2",json:JSON.stringify({selects:null,froms:null,wheres:null,limit:null,query:"EXECUTE Warehouse.dbo.usp_GetData4 @DomainCode = "+F3DWLD.CONFIG.domainCode+", @lang = 'E',@List1Codes = "+JSON.stringify(FAOSTATNEWOLAP.excelpayload.list1Codes).replace(/\"/g,"'").replace(/\[/g,"'(").replace(/\]/g,")'")+",@List2Codes = "+JSON.stringify(FAOSTATNEWOLAP.excelpayload.list2Codes).replace(/\"/g,"'").replace(/\[/g,"'(").replace(/\]/g,")'")+", @List3Codes = "+JSON.stringify(FAOSTATNEWOLAP.excelpayload.list3Codes).replace(/\"/g,"'").replace(/\[/g,"'(").replace(/\]/g,")'")+",@List4Codes = "+JSON.stringify(FAOSTATNEWOLAP.excelpayload.list4Codes).replace(/\"/g,"'").replace(/\[/g,"'(").replace(/\]/g,")'")+", @List5Codes = '', @List6Codes = '',  @List7Codes = '', @NullValues = 0, @Thousand = '',@Decimal = ',',  @DecPlaces = 2, @Pivot1="+retPivot1()+",@Pivot2="+retPivot2()+",@Pivot3='"+retPivot3()+"'",frequency:"NONE"}),cssFilename:"faostat",valueIndex:1};$.ajax({type:"POST",url:F3DWLD.CONFIG.data_url+"/table/"+a,data:c,success:function(b){for(document.getElementById("csvData").value="",j=0;j<FAOSTATNEWOLAP.PP.PP3.length;j++)j>0&&(document.getElementById("csvData").value+=","),document.getElementById("csvData").value+=FAOSTATNEWOLAP.traduction[FAOSTATNEWOLAP.PP.PP3[j]];if(document.getElementById("csvData").value+=recHeader("",FAOSTATNEWOLAP.PP.PP1,0),document.getElementById("csvData").value+="\n","html"===a)document.getElementById("excelData").value=b,document.getElementById("formExcel").submit();else{for(var c=0;c<b.length;c++)document.getElementById("csvData").value+='"'+b[c].join('","')+'"\n';var d=confirm("Press a button!");1==d&&document.getElementById("csvDataForm").submit()}},error:function(a){console.log(a)}})}function my_exportNewHTML(){monclone=$("#pivot_table").clone(),$("#renderer",monclone).remove(),$(".ordre",monclone).remove(),$("#unused",monclone).remove(),$("#aggregator",monclone).remove(),$("#vals",monclone).remove(),$("#cols",monclone).remove(),$("#rows",monclone).remove(),$(".pvtTotalLabel",monclone).remove(),$(".pvtTotal",monclone).remove(),$(".invi",monclone).remove(),$("thead",monclone).remove(),$(".pvtGrandTotal",monclone).remove(),$("td",monclone).css("border","1px solid black"),$("th",monclone).css("border","1px solid black"),$(".table",monclone).css("border","1px solid black");var a=new Date;document.getElementById("excelData").value="<table><tr><td>FAOSTAT "+a.getFullYear()+"</td><td colspan=2>Date : "+a.toLocaleDateString()+"</td></tr></table><table>"+monclone.html()+"</table>",document.getElementById("excelData").value+="<table><tr><td></td></tr>";var b=document.getElementById("hor-minimalist-b").getElementsByTagName("td");for(j=0,i=0;i<b.length;i++)0==j?(document.getElementById("excelData").value+="<tr><td>",j=1):(document.getElementById("excelData").value+="</td><td>",j=0),document.getElementById("excelData").value+=b[i].innerHTML,0==j&&(document.getElementById("excelData").value+="</tr>");document.getElementById("excelData").value+="</table>",document.getElementById("formExcel").submit()}function stringify(a){var b=Object.prototype.toString.call(a),c=Array.prototype.map||function(a){for(var b=[],c=0;c<this.length;c++)b.push(a(this[c]));return b};if("[object Object]"===b){var d=[];for(var e in a)a.hasOwnProperty(e)&&d.push([e,stringify(a[e])]);return d.sort(function(a,b){return a[0]<b[0]?-1:1}),d=c.call(d,function(a){return"format"!=a[0]&&"push"!=a[0]&&"value"!=a[0]?'"'+a[0].replace(/"/g,'\\"')+'":'+a[1]:'"'+a[0].replace(/"/g,'\\"')+'":""'}),"{"+d+"}"}return"[object Array]"===b?"["+c.call(a,function(a){return stringify(a)})+"]":JSON.stringify(a)}function my_exportNew(){for(var a=[],b=0;b<FAOSTATNEWOLAP.internalData.rowAttrs.length;b++)F3DWLD.CONFIG.wdsPayload.showCodes&&a.push(FAOSTATNEWOLAP.internalData.rowAttrs[b]+"Code"),a.push(FAOSTATNEWOLAP.internalData.rowAttrs[b]+"Name");flatColKeyst=[],tt=FAOSTATNEWOLAP.internalData.getColKeys();for(tti in tt)flatColKeyst.push(tt[tti].join("||"));document.getElementById("myJson").value=stringify({data:FAOSTATNEWOLAP.internalData.tree,header:flatColKeyst,cols:a,swUnit:FAOSTATNEWOLAP.showUnits,swFlag:FAOSTATNEWOLAP.showFlags}),document.getElementById("xlsDataForm").submit()}function decolrowspanNEW(){var a=new Date,b=new RegExp('<span class="ordre">[0-9]+</span>',"g"),c=new RegExp('<span class="ordre"></span>',"g"),d=new RegExp('<table class="innerCol"><th>([0-9]+)</th><th>([^>]*)</th></table>',"g"),e=FAOSTATNEWOLAP.internalData.tree;flatColKeyst=[],tt=FAOSTATNEWOLAP.internalData.getColKeys();for(tti in tt)flatColKeyst.push(tt[tti].join("||"));for(var f=flatColKeyst.sort(),g="",h=0;h<FAOSTATNEWOLAP.internalData.rowKeys[0].length;h++)F3DWLD.CONFIG.wdsPayload.showCodes&&(g+="Code,"),g+='"'+FAOSTATNEWOLAP.internalData.rowAttrs[h].replace("_","")+'",';for(h in f)g+='"'+f[h].replace(/,/g,"").replace(/\|\|/g,"-").replace(/&nbsp;/g,"").replace(d,"$1").replace(b,"").replace(c,"")+'"',FAOSTATNEWOLAP.showUnits&&(g+=",unit"),FAOSTATNEWOLAP.showFlags&&(g+=",flag"),g+=",";g+="\n";for(i in e){for(var j=i.split("||"),k=0;k<j.length;k++)g+='"'+j[k].replace(/,/g,"").replace(d,'$1","$2').replace(b,"").replace(c,"")+'",';for(h in f)try{e[i][f[h]]?g+='"'+addCommas(e[i][f[h]].value())+'",':(g+=",",FAOSTATNEWOLAP.showUnits&&(g+=","),FAOSTATNEWOLAP.showFlags&&(g+=","))}catch(l){}g+="\n"}try{var m=document.getElementById("hor-minimalist-b").getElementsByTagName("td");for(h=0,i=0;i<m.length;i++)0==h?(g+="\n",h=1):(g+=",",h=0),g+=m[i].innerHTML}catch(n){console.log("WS getFlag not available")}g+="\n\nFAOSTAT "+a.getFullYear()+", Date : "+a.toLocaleDateString()+"\n";var o=document.createElement("a");if(void 0!==o.download){var p=new Blob(["\ufeff",g],{type:"text/csv;charset=UTF-8;"}),q=URL.createObjectURL(p);o.setAttribute("href",q),o.setAttribute("download","fileName.csv"),o.style="visibility:hidden"}else navigator.msSaveBlob?o.addEventListener("click",function(){var a=new Blob(["\ufeff",g],{type:"text/csv;charset=UTF-8;"});navigator.msSaveBlob(a,"fileName.csv")},!1):(document.getElementById("csvData").value=g,document.getElementById("csvDataForm").submit());document.body.appendChild(o),o.click(),document.body.removeChild(o)}function decolrowspanExcell(a){var b=new Date;ret="",ret+="FAOSTAT "+b.getFullYear()+", Date : "+b.toLocaleDateString()+"\n";var c=document.createElement("a");if(void 0!==c.download){var d=new Blob(["\ufeff",ret,a],{type:"text/csv;charset=UTF-8;"}),e=URL.createObjectURL(d);c.setAttribute("href",e),c.setAttribute("download","fileName.xls"),c.style="visibility:hidden"}else navigator.msSaveBlob?c.addEventListener("click",function(){var b=new Blob(["\ufeff",ret,a],{type:"text/csv;charset=UTF-8;"});navigator.msSaveBlob(b,"fileName.xls")},!1):(document.getElementById("csvData").value=ret+a,document.getElementById("csvDataForm").submit());document.body.appendChild(c),c.click(),document.body.removeChild(c)}function colapseCol(){}function showHideTotals(){$("#cols li nobr").length*$("#rows li nobr").length==0?($(".pvtTotalLabel").show(),$(".pvtTotal").show(),$(".pvtGrandTotal").show()):($(".pvtTotalLabel").hide(),$(".pvtTotal").hide(),$(".pvtGrandTotal").hide())}function my_export(){monclone=$("#newOlap").clone(),$("#renderer",monclone).remove(),$("#unused",monclone).remove(),$("#aggregator",monclone).remove(),$("#vals",monclone).remove(),$("#cols",monclone).remove(),$("#rows",monclone).remove(),$(".pvtTotalLabel",monclone).remove(),$(".pvtTotal",monclone).remove(),$(".invi",monclone).remove(),$(".pvtGrandTotal",monclone).remove(),$("td",monclone).css("border-left","1px solid black"),$("td",monclone).css("border-top","1px solid black"),$("th",monclone).css("border-left","1px solid black"),$("th",monclone).css("border-top","1px solid black"),$(".table",monclone).css("border-right","1px solid black"),$(".table",monclone).css("border-bottom","1px solid black"),document.getElementById("excelData").value=monclone.html(),document.getElementById("formExcel").submit()}function myInitOLAP(){monXML="";var mesItems="",bItem=0,mesItemsXML="{name:'ItemCode','nb':'1','val':{",arrItem=$("#gridItemsAggregated").jqxGrid("selectedrowindexes"),listItem="",mySelecteds=F3DWLD.CONFIG.selectedValues;for(i=0;i<mySelecteds.items.length;i++)arr=mySelecteds.items[i],"list"==arr.type?""==listItem?listItem="[{code:'"+arr.code+"',type:'list'}":listItem+=",{code:'"+arr.code+"',type:'list'}":(""==mesItems?mesItems=arr.code:mesItems+=","+arr.code,0!=bItem?mesItemsXML+=",":bItem=1,mesItemsXML+="'"+arr.code+"':{'E':'"+arr.label.replace(/'/g," ")+"'}");""!=listItem?listItem+="]":listItem="[]";var mesElements="",mesElementsXML="{name:'ElementCode','nb':'1','val':{";for(i=0;i<mySelecteds.elements.length;i++)arr=mySelecteds.elements[i],""==mesElements?mesElements=arr.code:mesElements+=","+arr.code,0!=i&&(mesElementsXML+=","),mesElementsXML+="'"+arr.code+"':{'E':'"+arr.label.replace(/'/g," ")+"'}";mesElementsXML+="}}";var mesCountries="",bCountry=0,mesCountriesXML="{'name':'AreaCode','nb':'1','val':{",listCountry="";for(i=0;i<mySelecteds.countries.length;i++)arr=mySelecteds.countries[i],"list"==arr.type?""==listCountry?listCountry="[{code:'"+arr.code+"',type:'list'}":listCountry+=",{code:'"+arr.code+"',type:'list'}":(""==mesCountries?mesCountries=arr.code:mesCountries+=","+arr.code,0!=bCountry?mesCountriesXML+=",":bCountry=1,mesCountriesXML+="'"+arr.code+"':{'E':'"+arr.label.replace(/'/g," ")+"'}");""!=listCountry||null==listCountry?listCountry+="]":listCountry="[]";var data={};data.datasource=FAOSTATDownload.datasource,data.domainCode=FAOSTATDownload.domainCode,data.language=FAOSTATDownload.language,data.countries=listCountry,data.items=listItem,$.ajax({type:"POST",url:"http://"+FAOSTATDownload.baseurl+"/bletchley/rest/codes/list/post",data:data,success:function(response){response.constructor===String&&(response=jQuery.parseJSON(response)),testAjax=response[0];for(var i=0;i<testAjax.length;i++)testAjax2=testAjax[i],""==mesCountries?mesCountries=testAjax2.code:mesCountries+=","+testAjax2.code,0!=bCountry?mesCountriesXML+=",":bCountry=1,mesCountriesXML+="'"+testAjax2.code+"':{'E':'"+testAjax2.label.replace(/'/g," ")+"'}";mesCountriesXML+="}}",testAjax=response[1];for(var i=0;i<testAjax.length;i++)testAjax2=testAjax[i],""==mesItems?mesItems=testAjax2.code:mesItems+=","+testAjax2.code,0!=bItem?mesItemsXML+=",":bItem=1,mesItemsXML+="'"+testAjax2.code+"':{'E':'"+testAjax2.label.replace(/'/g," ")+"'}";mesItemsXML+="}}";var mesYears="",mesYearsXML="{'name':'Year',nb:'1','val':{";for(i=0;i<mySelecteds.years.length;i++)arr=mySelecteds.years[i],""==mesYears?mesYears=arr.code:mesYears+=","+arr.code,0!=i&&(mesYearsXML+=","),mesYearsXML+="'"+arr.code+"':{'E':'"+arr.label.toString().replace(/'/g," ")+"'}";mesYearsXML+="}}",FAOSTATOLAP2.queryParams.json=JSON.stringify({selects:[{aggregation:"NONE",column:"DOM.DomainNameE",alias:"Domain"},{aggregation:"NONE",column:"A.AreaCode",alias:"AreaCode"},{aggregation:"NONE",column:"A.AreaNameE",alias:"Area"},{aggregation:"NONE",column:"I.ItemCode",alias:"ItemCode"},{aggregation:"NONE",column:"I.ItemNameE",alias:"Item"},{aggregation:"NONE",column:"E.ElementCode",alias:"ElementCode"},{aggregation:"NONE",column:"E.ElementNameE",alias:"Element"},{aggregation:"NONE",column:"D.Year",alias:"Year"},{aggregation:"NONE",column:"D.Value",alias:"Value"},{aggregation:"NONE",column:"E.UnitNameE",alias:"Unit"},{aggregation:"NONE",column:"Flag",alias:"Flag"}],froms:[{column:"Data",alias:"D"},{column:"Item",alias:"I"},{column:"Element",alias:"E"},{column:"Area",alias:"A"},{column:"Domain",alias:"DOM"}],wheres:[{datatype:"TEXT",column:"D.DomainCode",operator:"=",value:""+FAOSTATDownload.domainCode,ins:[]},{datatype:"TEXT",column:"DOM.DomainCode",operator:"=",value:""+FAOSTATDownload.domainCode,ins:[]},{datatype:"DATE",column:"D.AreaCode",operator:"=",value:"A.AreaCode",ins:[]},{datatype:"DATE",column:"D.DomainCode",operator:"=",value:"DOM.DomainCode",ins:[]},{datatype:"DATE",column:"D.ItemCode",operator:"=",value:"I.ItemCode",ins:[]},{datatype:"DATE",column:"D.ElementCode",operator:"=",value:"E.ElementCode",ins:[]},{datatype:"TEXT",column:"D.ElementCode",operator:"IN",value:"E.ElementCode",ins:eval("["+mesElements+"]")},{datatype:"TEXT",column:"D.AreaCode",operator:"IN",value:"A.AreaCode",ins:eval("["+mesCountries+"]")},{datatype:"TEXT",column:"D.ItemCode",operator:"IN",value:"I.ItemCode",ins:eval("["+mesItems+"]")},{datatype:"TEXT",column:"D.Year",operator:"IN",value:"D.Year",ins:eval("["+mesYears+"]")}],orderBys:[{column:"D.Year",direction:"DESC"},{column:"A.AreaNameE",direction:"ASC"},{column:"I.ItemNameE",direction:"ASC"},{column:"E.ElementNameE",direction:"ASC"}],limit:null,query:null,frequency:"NONE"}),$.post("/wds/rest/table/json",FAOSTATOLAP2.queryParams).done(function(a){a=FAOSTATOLAP2.attr.concat(a),$("#newOlap").pivotUI(a,FAOSTATOLAP2.options,FAOSTATOLAP2.displayOption.overwrite)})}})}var test;FAOSTATNEWOLAP={},FAOSTATNEWOLAP.pivotlimit=1e4,FAOSTATNEWOLAP.pivotlimitExcel=2e5,FAOSTATNEWOLAP.limitPivotPreview=5e3,FAOSTATNEWOLAP.PP={PP1:[],PP2:[],PP3:[]},FAOSTATNEWOLAP.excelpayload={},FAOSTATNEWOLAP.schema={},FAOSTATNEWOLAP.rendererV=0,FAOSTATNEWOLAP.nestedby=0,FAOSTATNEWOLAP.viewVals=0,FAOSTATNEWOLAP.decimal=2,FAOSTATNEWOLAP.firstCall=1,FAOSTATNEWOLAP.flags={},FAOSTATNEWOLAP.internalData={},FAOSTATNEWOLAP.originalData=[],FAOSTATNEWOLAP.thousandSeparator=" ",FAOSTATNEWOLAP.decimalSeparator=".",FAOSTATNEWOLAP.traduction={Var1:"Country",Var2:"Element",Var3:"Item",Var4:"Year"};var F3DWLD={CONFIG:{wdsPayload:{showCodes:!1}}},internalTest;(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},s=[].slice,t=function(a,b){return function(){return a.apply(b,arguments)}},u={}.hasOwnProperty;a=jQuery,c=function(a,b,c){var d,e,f,g;for(a+="",e=a.split("."),f=e[0],g=e.length>1?c+e[1]:"",d=/(\d+)(\d{3})/;d.test(f);)f=f.replace(d,"$1"+b+"$2");return f+g},arrayFormat=function(a){return sigfig=3,scaler=1,function(b){var d;return isNaN(b)||!isFinite(b)?"":0!==b||a.showZero?(d=c((a.scaler*b).toFixed(a.digitsAfterDecimal),a.thousandsSep,a.decimalSep),""+a.prefix+d+a.suffix):""}},k=function(b){var d;return d={digitsAfterDecimal:2,scaler:1,thousandsSep:",",decimalSep:".",prefix:"",suffix:"",showZero:!1},b=a.extend(d,b),function(a){var d;return isNaN(a)||!isFinite(a)?"":0!==a||b.showZero?(d=c((b.scaler*a).toFixed(b.digitsAfterDecimal),b.thousandsSep,b.decimalSep),""+b.prefix+d+b.suffix):""}},n=k(),arrFmt=arrayFormat(),o=k({digitsAfterDecimal:0}),p=k({digitsAfterDecimal:1,scaler:100,suffix:"%"}),d={count:function(a){return null==a&&(a=o),function(){return function(){return{count:0,push:function(){return this.count++},value:function(){return this.count},format:a}}}},countUnique:function(a){return null==a&&(a=o),function(b){var c;return c=b[0],function(){return{uniq:[],push:function(a){var b;return b=a[c],r.call(this.uniq,b)<0?this.uniq.push(a[c]):void 0},value:function(){return this.uniq.length},format:a,numInputs:null!=c?0:1}}}},listUnique:function(a){return function(b){var c;return c=b[0],function(){return{uniq:[],push:function(a){var b;return b=a[c],r.call(this.uniq,b)<0?this.uniq.push(a[c]):void 0},value:function(){return this.uniq.join(a)},format:function(a){return a},numInputs:null!=c?0:1}}}},sum:function(a){return null==a&&(a=n),function(b){var c;return c=b[0],function(){return{sum:0,push:function(a){return isNaN(parseFloat(a[c]))?void 0:this.sum+=parseFloat(a[c])},value:function(){return this.sum},format:a,numInputs:null!=c?0:1}}}},sum2:function(){return sigfig=3,scaler=1,function(a){var b;b=a[0];return function(){return{sum:[0,"_","_"],push:function(b){for(var c=0;c<a.length;c++)"Flag"==a[c]?"_"==this.sum[c]?(this.sum[c]=""!=b[a[c]]?b[a[c]]:"&nbsp;",FAOSTATNEWOLAP.flags[b[a[c]]]=1):this.sum[c]="Agg":"Value"==a[c]?this.sum[c]=parseFloat(b[a[c]]):"Unit"==a[c]&&("_"==this.sum[c]||this.sum[c]==b[a[c]]?this.sum[c]=""!=b[a[c]]?b[a[c]]:"&nbsp;":(this.sum[0]=0/0,this.sum[c]="nan"));return this.sum},value:function(){return this.sum},format:arrFmt,label:"Sum of "+b}}}},average:function(a){return null==a&&(a=n),function(b){var c;return c=b[0],function(){return{sum:0,len:0,push:function(a){return isNaN(parseFloat(a[c]))?void 0:(this.sum+=parseFloat(a[c]),this.len++)},value:function(){return this.sum/this.len},format:a,numInputs:null!=c?0:1}}}},sumOverSum:function(a){return null==a&&(a=n),function(b){var c,d;return d=b[0],c=b[1],function(){return{sumNum:0,sumDenom:0,push:function(a){return isNaN(parseFloat(a[d]))||(this.sumNum+=parseFloat(a[d])),isNaN(parseFloat(a[c]))?void 0:this.sumDenom+=parseFloat(a[c])},value:function(){return this.sumNum/this.sumDenom},format:a,numInputs:null!=d&&null!=c?0:2}}}},sumOverSumBound80:function(a,b){return null==a&&(a=!0),null==b&&(b=n),function(c){var d,e;return e=c[0],d=c[1],function(){return{sumNum:0,sumDenom:0,push:function(a){return isNaN(parseFloat(a[e]))||(this.sumNum+=parseFloat(a[e])),isNaN(parseFloat(a[d]))?void 0:this.sumDenom+=parseFloat(a[d])},value:function(){var b;return b=a?1:-1,(.821187207574908/this.sumDenom+this.sumNum/this.sumDenom+1.2815515655446004*b*Math.sqrt(.410593603787454/(this.sumDenom*this.sumDenom)+this.sumNum*(1-this.sumNum/this.sumDenom)/(this.sumDenom*this.sumDenom)))/(1+1.642374415149816/this.sumDenom)},format:b,numInputs:null!=e&&null!=d?0:2}}}},fractionOf:function(a,b,c){return null==b&&(b="total"),null==c&&(c=p),function(){var d;return d=1<=arguments.length?s.call(arguments,0):[],function(e,f,g){return{selector:{total:[[],[]],row:[f,[]],col:[[],g]}[b],inner:a.apply(null,d)(e,f,g),push:function(a){return this.inner.push(a)},format:c,value:function(){return this.inner.value()/e.getAggregator.apply(e,this.selector).inner.value()},numInputs:a.apply(null,d)().numInputs}}}}},e=function(a){return{Sum:a.sum(),Count:a.count(o),"Count Unique Values":a.countUnique(o),"List Unique Values":a.listUnique(", "),"Integer Sum":a.sum(o),Average:a.average(n),"Sum over Sum":a.sumOverSum(n),"80% Upper Bound":a.sumOverSumBound80(!0,n),"80% Lower Bound":a.sumOverSumBound80(!1,n),"Sum as Fraction of Total":a.fractionOf(a.sum(),"total",p),"Sum as Fraction of Rows":a.fractionOf(a.sum(),"row",p),"Sum as Fraction of Columns":a.fractionOf(a.sum(),"col",p),"Count as Fraction of Total":a.fractionOf(a.count(),"total",p),"Count as Fraction of Rows":a.fractionOf(a.count(),"row",p),"Count as Fraction of Columns":a.fractionOf(a.count(),"col",p)}}(d),aggregators2=function(a){return{Sum:a.sum(o),Average:a.average(n)}}(d),m={Table:function(a,b){return l(a,b)},"Table Barchart":function(b,c){return a(l(b,c)).barchart()},Heatmap:function(b,c){return a(l(b,c)).heatmap()},"Row Heatmap":function(b,c){return a(l(b,c)).heatmap("rowheatmap")},"Col Heatmap":function(b,c){return a(l(b,c)).heatmap("colheatmap")}},renderers2={Table:function(b){a("#myGrid1_div").show(),a("#fx-olap-holder-div").hide(),newGrid(b)},"Table Barchart":function(b,c){return a("#myGrid1_div").hide(),a("#fx-olap-holder-div").show(),a(l(b,c)).barchart()},Heatmap:function(b,c){return a("#myGrid1_div").hide(),a("#fx-olap-holder-div").show(),a(l(b,c)).heatmap()},"Row Heatmap":function(b,c){return a("#myGrid1_div").hide(),a("#fx-olap-holder-div").show(),a(l(b,c)).heatmap("rowheatmap")},"Col Heatmap":function(b,c){return a("#myGrid1_div").hide(),a("#fx-olap-holder-div").show(),a(l(b,c)).heatmap("colheatmap")}},h={en2:{aggregators:e,renderers:m,localeStrings:{renderError:"An error occurred rendering the PivotTable results.",computeError:"An error occurred computing the PivotTable results.",uiRenderError:"An error occurred rendering the PivotTable UI.",selectAll:"Select All",selectNone:"Select None",tooMany:"(too many to list)",filterResults:"Filter results",totals:"Totals",vs:"vs",by:"by"}},en:{aggregators:aggregators2,renderers:renderers2,
localeStrings:{renderError:"An error occurred rendering the PivotTable results.",computeError:"An error occurred computing the PivotTable results.",uiRenderError:"An error occurred rendering the PivotTable UI.",selectAll:"Select All",selectNone:"Select None",tooMany:"(too many to list)",filterResults:"Filter results",totals:"Totals",vs:"vs",by:"by"}}},i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],f=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],q=function(a){return("0"+a).substr(-2,2)},g={bin:function(a,b){return function(c){return c[a]-c[a]%b}},dateFormat:function(a,b,c,d){return null==c&&(c=i),null==d&&(d=f),function(e){var f;return f=new Date(Date.parse(e[a])),isNaN(f)?"":b.replace(/%(.)/g,function(a,b){switch(b){case"y":return f.getFullYear();case"m":return q(f.getMonth()+1);case"n":return c[f.getMonth()];case"d":return q(f.getDate());case"w":return d[f.getDay()];case"x":return f.getDay();case"H":return q(f.getHours());case"M":return q(f.getMinutes());case"S":return q(f.getSeconds());default:return"%"+b}})}}},j=function(){return function(a,b){var c,d,e,f,g,h,i;if(h=/(\d+)|(\D+)/g,g=/\d/,i=/^0/,"number"==typeof a||"number"==typeof b)return isNaN(a)?1:isNaN(b)?-1:a-b;if(c=String(a).toLowerCase(),e=String(b).toLowerCase(),c===e)return 0;if(!g.test(c)||!g.test(e))return c>e?1:-1;for(c=c.match(h),e=e.match(h);c.length&&e.length;)if(d=c.shift(),f=e.shift(),d!==f)return g.test(d)&&g.test(f)?d.replace(i,".0")-f.replace(i,".0"):d>f?1:-1;return c.length-e.length}}(this),a.pivotUtilities={aggregatorTemplates:d,aggregators:e,renderers:m,derivers:g,locales:h,naturalSort:j,numberFormat:k},b=function(){function b(a,c){this.getAggregator=t(this.getAggregator,this),this.getRowKeys=t(this.getRowKeys,this),this.getColKeys=t(this.getColKeys,this),this.sortKeys=t(this.sortKeys,this),this.arrSort=t(this.arrSort,this),this.natSort=t(this.natSort,this),this.aggregator=c.aggregator,this.aggregatorName=c.aggregatorName,this.colAttrs=c.cols,this.rowAttrs=c.rows,this.valAttrs=c.vals,this.tree={},this.rowKeys=[],this.colKeys=[],this.rowTotals={},this.colTotals={},this.allTotal=this.aggregator(this,[],[]),this.sorted=!1,b.forEachRecord(a,c.derivedAttributes,function(a){return function(b){return c.filter(b)?a.processRecord(b):void 0}}(this))}return b.forEachRecord=function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p;if(e=a.isEmptyObject(c)?d:function(a){var b,e,f;for(b in c)e=c[b],a[b]=null!=(f=e(a))?f:a[b];return d(a)},a.isFunction(b))return b(e);if(a.isArray(b)){if(a.isArray(b[0])){o=[];for(g in b)if(u.call(b,g)&&(f=b[g],g>0)){j={},n=b[0];for(h in n)u.call(n,h)&&(i=n[h],j[i]=f[h]);o.push(e(j))}return o}for(p=[],l=0,m=b.length;m>l;l++)j=b[l],p.push(e(j));return p}if(b instanceof jQuery)return k=[],a("thead > tr > th",b).each(function(){return k.push(a(this).text())}),a("tbody > tr",b).each(function(){return j={},a("td",this).each(function(b){return j[k[b]]=a(this).text()}),e(j)});throw new Error("unknown input format")},b.convertToArray=function(a){var c;return c=[],b.forEachRecord(a,{},function(a){return c.push(a)}),c},b.prototype.natSort=function(a,b){return j(a,b)},b.prototype.arrSort=function(a,b){return this.natSort(a.join(),b.join())},b.prototype.sortKeys=function(){return this.sorted||(this.rowKeys.sort(this.arrSort),this.colKeys.sort(this.arrSort)),this.sorted=!0},b.prototype.getColKeys=function(){return this.sortKeys(),this.colKeys},b.prototype.getRowKeys=function(){return this.sortKeys(),this.rowKeys},b.prototype.processRecord=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;for(b=[],e=[],k=this.colAttrs,g=0,i=k.length;i>g;g++)f=k[g],b.push(null!=(l=a[f])?l:"null");for(m=this.rowAttrs,h=0,j=m.length;j>h;h++)f=m[h],e.push(null!=(n=a[f])?n:"null");return d=e.join("||"),c=b.join("||"),this.allTotal.push(a),0!==e.length&&(this.rowTotals[d]||(this.rowKeys.push(e),this.rowTotals[d]=this.aggregator(this,e,[])),this.rowTotals[d].push(a)),0!==b.length&&(this.colTotals[c]||(this.colKeys.push(b),this.colTotals[c]=this.aggregator(this,[],b)),this.colTotals[c].push(a)),0!==b.length&&0!==e.length?(this.tree[d]||(this.tree[d]={}),this.tree[d][c]||(this.tree[d][c]=this.aggregator(this,e,b)),this.tree[d][c].push(a)):void 0},b.prototype.getAggregator=function(a,b){var c,d,e;return e=a.join("||"),d=b.join("||"),c=0===a.length&&0===b.length?this.allTotal:0===a.length?this.colTotals[d]:0===b.length?this.rowTotals[e]:this.tree[e][d],null!=c?c:{value:function(){return null},format:function(){return""}}},b}(),l=function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,v,w,x,y;i={localeStrings:{totals:"Totals"}},c=a.extend(i,c),f=b.colAttrs,n=b.rowAttrs,p=b.getRowKeys(),h=b.getColKeys(),m=document.createElement("table"),m.className="pvtTable",q=function(a,b,c){var d,e,f,g,h,i;if(0!==b){for(e=!0,g=h=0;c>=0?c>=h:h>=c;g=c>=0?++h:--h)a[b-1][g]!==a[b][g]&&(e=!1);if(e)return-1}for(d=0;b+d<a.length;){for(f=!1,g=i=0;c>=0?c>=i:i>=c;g=c>=0?++i:--i)a[b][g]!==a[b+d][g]&&(f=!0);if(f)break;d++}return d};for(k in f)if(u.call(f,k)){e=f[k],v=document.createElement("tr"),0===parseInt(k)&&0!==n.length&&(s=document.createElement("th"),s.setAttribute("colspan",n.length),s.setAttribute("rowspan",f.length),v.appendChild(s)),s=document.createElement("th"),s.className="pvtAxisLabel",s.textContent=e,v.appendChild(s);for(j in h)u.call(h,j)&&(g=h[j],y=q(h,parseInt(j),parseInt(k)),-1!==y&&(s=document.createElement("th"),s.className="pvtColLabel",s.innerHTML=g[k],s.setAttribute("colspan",y),parseInt(k)===f.length-1&&0!==n.length&&s.setAttribute("rowspan",2),v.appendChild(s)));0===parseInt(k)&&(s=document.createElement("th"),s.className="pvtTotalLabel",s.innerHTML=c.localeStrings.totals,s.setAttribute("rowspan",f.length+(0===n.length?0:1)),v.appendChild(s)),m.appendChild(v)}if(0!==n.length){v=document.createElement("tr");for(j in n)u.call(n,j)&&(l=n[j],s=document.createElement("th"),s.className="pvtAxisLabel",s.textContent=l,v.appendChild(s));s=document.createElement("th"),0===f.length&&(s.className="pvtTotalLabel",s.innerHTML=c.localeStrings.totals),v.appendChild(s),m.appendChild(v)}for(j in p)if(u.call(p,j)){o=p[j],v=document.createElement("tr");for(k in o)u.call(o,k)&&(w=o[k],y=q(p,parseInt(j),parseInt(k)),-1!==y&&(s=document.createElement("th"),s.className="pvtRowLabel",s.innerHTML=w,s.setAttribute("rowspan",y),parseInt(k)===n.length-1&&0!==f.length&&s.setAttribute("colspan",2),v.appendChild(s)));for(k in h)u.call(h,k)&&(g=h[k],d=b.getAggregator(o,g),x=d.value(),r=document.createElement("td"),r.className="pvtVal row"+j+" col"+k,r.innerHTML=d.format(x),r.setAttribute("data-value",x),v.appendChild(r));t=b.getAggregator(o,[]),x=t.value(),r=document.createElement("td"),r.className="pvtTotal rowTotal",r.innerHTML=t.format(x),r.setAttribute("data-value",x),r.setAttribute("data-for","row"+j),v.appendChild(r),m.appendChild(v)}v=document.createElement("tr"),s=document.createElement("th"),s.className="pvtTotalLabel",s.innerHTML=c.localeStrings.totals,s.setAttribute("colspan",n.length+(0===f.length?0:1)),v.appendChild(s);for(k in h)u.call(h,k)&&(g=h[k],t=b.getAggregator([],g),x=t.value(),r=document.createElement("td"),r.className="pvtTotal colTotal",r.innerHTML=t.format(x),r.setAttribute("data-value",x),r.setAttribute("data-for","col"+k),v.appendChild(r));return t=b.getAggregator([],[]),x=t.value(),r=document.createElement("td"),r.className="pvtGrandTotal",r.innerHTML=t.format(x),r.setAttribute("data-value",x),v.appendChild(r),m.appendChild(v),m.setAttribute("data-numrows",p.length),m.setAttribute("data-numcols",h.length),m},a.fn.pivot=function(c,e){var f,g,i;for(f={cols:[],rows:[],filter:function(){return!0},aggregator:d.count()(),aggregatorName:"Count",derivedAttributes:{},renderer:l,rendererOptions:null,localeStrings:h.en.localeStrings},e=a.extend(f,e),g=null,FAOSTATNEWOLAP.internalData=new b(c,e),g=e.renderer(FAOSTATNEWOLAP.internalData,e.rendererOptions),i=this[0];i.hasChildNodes();)i.removeChild(i.lastChild);return this.append(g)},a.fn.pivotUI=function(c,d,e,f){var g,i,k,l,m,n,o,p,q,s,t,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V;null==e&&(e=!1),null==f&&(f="en"),o={derivedAttributes:{},aggregators:h[f].aggregators,renderers:h[f].renderers,hiddenAttributes:[],menuLimit:500,cols:[],rows:[],vals:[],exclusions:{},unusedAttrsVertical:!1,autoSortUnusedAttrs:!1,rendererOptions:{localeStrings:h[f].localeStrings},onRefresh:null,filter:function(){return!0},localeStrings:h[f].localeStrings},p=this.data("pivotUIOptions"),v=null==p||e?a.extend(o,d):p,c=b.convertToArray(c),C=function(){var a,b;a=c[0],b=[];for(t in a)u.call(a,t)&&b.push(t);return b}(),R=v.derivedAttributes;for(m in R)u.call(R,m)&&r.call(C,m)<0&&C.push(m);for(l={},J=0,N=C.length;N>J;J++)H=C[J],l[H]={};b.forEachRecord(c,v.derivedAttributes,function(a){var b,c,d;d=[];for(t in a)u.call(a,t)&&(b=a[t],v.filter(a)&&(null==b&&(b="null"),null==(c=l[t])[b]&&(c[b]=0),d.push(l[t][b]++)));return d}),F=a("<table cellpadding='5'>"),A=a("<td id='vals' class='pvtAxisContainer pvtUnused'>"),z=a("<select class='pvtRenderer'>").appendTo(A).bind("change",function(){return x()}),S=v.renderers;for(H in S)u.call(S,H)&&a("<option>").val(H).html(H).appendTo(z);if(n=a("<td id='unused' class='pvtAxisContainer pvtUnused'>"),B=function(){var a,b,c;for(c=[],a=0,b=C.length;b>a;a++)m=C[a],r.call(v.hiddenAttributes,m)<0&&c.push(m);return c}(),G=!1,"auto"===v.unusedAttrsVertical){for(k=0,K=0,O=B.length;O>K;K++)g=B[K],k+=g.length;G=k>120}n.addClass(v.unusedAttrsVertical===!0||G?"pvtVertList":"pvtHorizList"),I=function(b){var c,d,e,f,g,h,i,k,m,o,p,s,u,w,y;if(i=function(){var a;a=[];for(t in l[b])a.push(t);return a}(),h=!1,s=a("<div>").addClass("pvtFilterBox").hide(),s.append(a("<h4>").text(""+b+" ("+i.length+")")),i.length>v.menuLimit)s.append(a("<p>").html(v.localeStrings.tooMany));else for(d=a("<p>").appendTo(s),d.append(a("<button>").html(v.localeStrings.selectAll).bind("click",function(){return s.find("input:visible").prop("checked",!0)})),d.append(a("<button>").html(v.localeStrings.selectNone).bind("click",function(){return s.find("input:visible").prop("checked",!1)})),d.append(a("<input>").addClass("pvtSearch").attr("placeholder",v.localeStrings.filterResults).bind("keyup",function(){var b;return b=a(this).val().toLowerCase(),a(this).parents(".pvtFilterBox").find("label span").each(function(){var c;return c=a(this).text().toLowerCase().indexOf(b),-1!==c?a(this).parent().show():a(this).parent().hide()})})),e=a("<div>").addClass("pvtCheckContainer").appendTo(s),y=i.sort(j),u=0,w=y.length;w>u;u++)t=y[u],p=l[b][t],f=a("<label>"),g=v.exclusions[b]?r.call(v.exclusions[b],t)>=0:!1,h||(h=g),a("<input type='checkbox' class='pvtFilter'>").attr("checked",!g).data("filter",[b,t]).appendTo(f),f.append(a("<span>").html(""+t+" ("+p+")")),e.append(a("<p>").append(f));return o=function(){var b;return b=a(s).find("[type='checkbox']").length-a(s).find("[type='checkbox']:checked").length,b>0?c.addClass("pvtFilteredAttribute"):c.removeClass("pvtFilteredAttribute"),i.length>v.menuLimit?s.toggle():s.toggle(0,x)},a("<p>").appendTo(s).append(a("<button>").text("OK").bind("click",o)),k=function(){return s.css({left:50,top:0}).toggle(),a(".pvtSearch").val(""),a("label").show()},m=a("<span class='pvtTriangle'>").html(" &#x25BE;").bind("click",k),c=a("<li class='axis_"+q+"' id='filtre_"+b+"'>").append(a("<span class='pvtAttr'>").html(b).data("attrName",b).append(m)),h&&c.addClass("pvtFilteredAttribute"),n.append(c).append(s),c.bind("dblclick",k)};for(q in B)m=B[q],I(m);D=a("<tr>").appendTo(F),i=a("<select class='pvtAggregator'>").bind("change",function(){return x()}),T=v.aggregators;for(H in T)u.call(T,H)&&i.append(a("<option>").val(H).html(H));for(a("<td class='pvtAxisContainer pvtHorizList pvtCols'>").appendTo(D),a("<td class='pvtVals'>").appendTo(D).append(i).append(a("<br>")),E=a("<tr>").appendTo(F),E.append(a("<td id=pretd1>")),w=a("<td valign='top' id='pvtRendererArea' class='pvtRendererArea'>").append("<div  id='pivot_table'>").appendTo(a("#fx-olap-holder-div")),v.unusedAttrsVertical===!0||G?(F.find("tr:nth-child(1)").prepend(A),F.find("tr:nth-child(2)").prepend(n)):(F.prepend(a("<tr>").append(a("<td id='rows' valign='top' class='pvtAxisContainer pvtRows pvtHorizList'>")).prepend(a("<td id='pretd'>&nbsp;</td>"))),F.prepend(a("<tr>").append(n).append(A))),this.html(F),U=v.cols,L=0,P=U.length;P>L;L++)H=U[L],this.find(".pvtCols").append(this.find(".axis_"+B.indexOf(H)));for(V=v.rows,M=0,Q=V.length;Q>M;M++)H=V[M],this.find(".pvtRows").append(this.find(".axis_"+B.indexOf(H)));return null!=v.aggregatorName&&this.find(".pvtAggregator").val(v.aggregatorName),null!=v.rendererName&&this.find(".pvtRenderer").val(v.rendererName),s=!0,y=function(b){return function(){var d,e,f,g,h,j,k,l,m,n,o,p,u,y;if(l={derivedAttributes:v.derivedAttributes,localeStrings:v.localeStrings,rendererOptions:v.rendererOptions,cols:[],rows:[]},h=null!=(y=v.aggregators[i.val()]([])().numInputs)?y:0,n=[],b.find(".pvtRows li span.pvtAttr").each(function(){return l.rows.push(a(this).data("attrName"))}),b.find(".pvtCols li span.pvtAttr").each(function(){return l.cols.push(a(this).data("attrName"))}),b.find(".pvtVals select.pvtAttrDropdown").each(function(){return 0===h?a(this).remove():(h--,""!==a(this).val()?n.push(a(this).val()):void 0)}),0!==h)for(k=b.find(".pvtVals"),H=p=0;h>=0?h>p:p>h;H=h>=0?++p:--p){for(g=a("<select class='pvtAttrDropdown'>").append(a("<option>")).bind("change",function(){return x()}),u=0,o=B.length;o>u;u++)d=B[u],g.append(a("<option>").val(d).html(d));k.append(g)}return s&&(n=v.vals,q=0,b.find(".pvtVals select.pvtAttrDropdown").each(function(){return a(this).val(n[q]),q++}),s=!1),l.aggregatorName=i.val(),l.vals=n,l.aggregator=v.aggregators[i.val()](n),l.renderer=v.renderers[z.val()],e={},b.find("input.pvtFilter").not(":checked").each(function(){var b;return b=a(this).data("filter"),null!=e[b[0]]?e[b[0]].push(b[1]):e[b[0]]=[b[1]]}),l.filter=function(a){var b,c;if(!v.filter(a))return!1;for(t in e)if(b=e[t],c=""+a[t],r.call(b,c)>=0)return!1;return!0},w.pivot(c,l),j=a.extend(v,{cols:l.cols,rows:l.rows,vals:n,exclusions:e,aggregatorName:i.val(),rendererName:z.val()}),b.data("pivotUIOptions",j),v.autoSortUnusedAttrs&&(f=a.pivotUtilities.naturalSort,m=b.find("td.pvtUnused.pvtAxisContainer"),a(m).children("li").sort(function(b,c){return f(a(b).text(),a(c).text())}).appendTo(m)),w.css("opacity",1),null!=v.onRefresh?v.onRefresh(j):void 0}}(this),x=function(){return function(){return w.css("opacity",.5),setTimeout(y,10)}}(this),x(),this.find(".pvtAxisContainer").sortable({update:function(a,b){return null==b.sender?x():void 0},connectWith:this.find(".pvtAxisContainer"),items:"li",placeholder:"pvtPlaceholder"}),this},a.fn.heatmap=function(b){var c,d,e,f,g,h,i,j;switch(null==b&&(b="heatmap"),h=this.data("numrows"),g=this.data("numcols"),c=function(a,b,c){var d;return d=function(){switch(a){case"red":return function(a){return"ff"+a+a};case"green":return function(a){return""+a+"ff"+a};case"blue":return function(a){return""+a+a+"ff"}}}(),function(a){var e,f;return f=255-Math.round(255*(a-b)/(c-b)),e=f.toString(16).split(".")[0],1===e.length&&(e=0+e),d(e)}},d=function(b){return function(d,e){var f,g,h;return g=function(c){return b.find(d).each(function(){var b;return b=a(this).data("value"),null!=b&&isFinite(b)?c(b,a(this)):void 0})},h=[],g(function(a){return h.push(a)}),f=c(e,Math.min.apply(Math,h),Math.max.apply(Math,h)),g(function(a,b){return b.css("background-color","#"+f(a))})}}(this),b){case"heatmap":d(".pvtVal","red");break;case"rowheatmap":for(e=i=0;h>=0?h>i:i>h;e=h>=0?++i:--i)d(".pvtVal.row"+e,"red");break;case"colheatmap":for(f=j=0;g>=0?g>j:j>g;f=g>=0?++j:--j)d(".pvtVal.col"+f,"red")}return d(".pvtTotal.rowTotal","red"),d(".pvtTotal.colTotal","red"),this},a.fn.barchart=function(){var b,c,d,e,f;for(e=this.data("numrows"),d=this.data("numcols"),b=function(b){return function(c){var d,e,f,g;return d=function(d){return b.find(c).each(function(){var b;return b=a(this).data("value"),null!=b&&isFinite(b)?d(b,a(this)):void 0})},g=[],d(function(a){return g.push(a)}),e=Math.max.apply(Math,g),f=function(a){return 100*a/(1.4*e)},d(function(b,c){var d,e;return d=c.text(),e=a("<div>").css({position:"relative",height:"55px"}),e.append(a("<div>").css({position:"absolute",bottom:0,left:0,right:0,height:f(b)+"%","background-color":"gray"})),e.append(a("<div>").text(d).css({position:"relative","padding-left":"5px","padding-right":"5px"})),c.css({padding:0,"padding-top":"5px","text-align":"center"}).html(e)})}}(this),c=f=0;e>=0?e>f:f>e;c=e>=0?++f:--f)b(".pvtVal.row"+c);return b(".pvtTotal.colTotal"),this}}).call(this);